# Copyright 2021-2022 VMware, Inc.
# SPDX-License-Identifier: BSD-2-Clause
---
# Get the number of specified disk controller type through
# vmware_guest_controller module
# Parameters:
#   disk_controller: valid values are 'scsi', 'sata', 'nvme'
#
- name: "Set fact of the valid disk controller type list"
  set_fact:
    valid_ctl_list:
      - scsi
      - sata
      - nvme
- name: "Check required parameter"
  assert:
    that:
      - disk_controller is defined
      - disk_controller in valid_ctl_list
    fail_msg: "'disk_controller' parameter must be defined and in {{ valid_ctl_list }}"

- include_tasks: vm_get_disk_controller_facts.yml
- name: "Set fact of the number of '{{ disk_controller }}' controller"
  set_fact:
    vhba_number: "{{ disk_controller_facts.disk_controller_data[disk_controller] | length }}"
- debug:
    msg: "Total number of '{{ disk_controller }}' disk controller: {{ vhba_number }}"
