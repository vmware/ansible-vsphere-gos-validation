# Copyright 2021-2022 VMware, Inc.
# SPDX-License-Identifier: BSD-2-Clause
---
# Check Windows guest BSOD keyword in vmware.log,
# default timeout is 60s
- name: Set fact of the key strings
  set_fact:
    guest_bsod_keyword: "WinBSOD:"

- include_tasks: ../../common/vm_wait_log_msg.yml
  vars:
    vm_wait_log_name: "vmware.log"
    vm_wait_log_msg: "{{ guest_bsod_keyword }}"
    vm_wait_log_retries: 20
    vm_wait_log_delay: 3
    vm_wait_log_ignore_errors: True

# Fail when get Windows guest BSOD keyword in vmware.log
- block:
    - include_tasks: ../../common/vm_take_screenshot.yml
      vars:
        vm_take_screenshot_local_path: "{{ current_test_log_folder }}"
    - name: Check the number of key strings
      fail:
        msg: "Get Windows guest BSOD keyword '{{ guest_bsod_keyword }}' in vmware.log."
  when: vm_wait_log_msg_success | bool
