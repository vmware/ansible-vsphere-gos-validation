# Copyright 2022 VMware, Inc.
# SPDX-License-Identifier: BSD-2-Clause
---
# Set the boot disk to the specified one.
# Parameters:
#   hdd_name: the specified boot disk name. E.g. 'Hard disk 1' which can be got from vSphere Web UI
#
- name: Check required parameter
  ansible.builtin.assert:
    that:
      - hdd_name is defined
      - hdd_name
    fail_msg: "hdd_name is not defined"

# Shutdown guest OS
- include_tasks: ../utils/win_shutdown_restart.yml
  vars:
    set_win_power_state: "shutdown"

# Set the boot disk to the first disk
- include_tasks: ../../common/vm_set_boot_options.yml
  vars:
    boot_hdd_name: "{{ hdd_name }}"

# Power on VM
- include_tasks: ../../common/vm_set_power_state.yml
  vars:
    vm_power_state_set: "powered-on"

- include_tasks: ../utils/win_update_inventory.yml