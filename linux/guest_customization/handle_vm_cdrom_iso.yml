# Copyright 2026 VMware, Inc.
# SPDX-License-Identifier: BSD-2-Clause
---
- name: "Get VM CDROM devices"
  include_tasks: ../../common/vm_get_cdrom_devices.yml

- name: "Get VM CDROM devices which attaching ISO file"
  ansible.builtin.set_fact:
    cdrom_device_with_iso_list: "{{ cdrom_device_list | selectattr('summary', 'match', 'ISO.*' ) }}"
  when: cdrom_device_list | length > 0

- name: "Set VM CDROM devices to client device"
  include_tasks: ../../common/vm_configure_cdrom.yml
  vars:
    cdrom_type: client
    cdrom_controller_type: "{{ item.controller_label.split(' ')[0] | lower }}"
    cdrom_controller_num: "{{ item.bus_num | int }}"
    cdrom_unit_num: "{{ item.unit_num | int }}"
  with_items: "{{ cdrom_device_with_iso_list }}"
  when:
    - cdrom_device_with_iso_list is defined
    - cdrom_device_with_iso_list | length > 0
