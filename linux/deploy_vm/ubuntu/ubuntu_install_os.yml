# Copyright 2021-2022 VMware, Inc.
# SPDX-License-Identifier: BSD-2-Clause
---
# Start to Ubuntu OS install
- include_tasks: ./ubuntu_autoinstall.yml
  when: ubuntu_install_method == "simulation"

- block:
    # Wait for autoinstall start message in serial port output file
    - include_tasks: ../../../common/vm_wait_logbundle_msg.yml
      vars:
        vm_wait_logbundle_name: "{{ vm_serial_port_output_file | basename }}"
        vm_wait_logbundle_msg: "{{ autoinstall_start_msg }}"
        vm_wait_logbundle_retries: 150
        vm_wait_logbundle_delay: 5

    - include_tasks: ../../../common/vm_wait_guest_ip.yml

    - name: Sleep 200 seconds to wait confirm message for ubuntu
      pause:
        seconds: 200

    - include_tasks: ../../../common/vm_guest_send_key.yml
      vars:
        keys_send:
          - ENTER
        string_send: 'yes'
    - include_tasks: ../../../common/vm_guest_send_key.yml
      vars:
        keys_send:
          - ENTER
  when: ubuntu_install_method == "cloud-init"
